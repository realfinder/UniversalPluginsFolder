<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
	<title>F2Quiver & F2QTest</title>
</head>

<body>
	   <font color="#cc0033"><h1>F2Quiver & F2QTest</h1></font>
	 
	  <BR><b>Author V. C. Mohan</b>
	  <BR>Date 1 Oct 2020
	  
	  <BR>EMail: <a href="mailto:mohanvc@gmail.com">mohanvc</a>
	  
	 

<p>F2Quiver ,  function  transform image into 2d frequency domain, applies filters 
and transforms back into image domain.  Gaussian 
or Butterworth  band stop, lowcut, high cut and notch filters are designed 
with circular, or vertical, or horizontal, or point or line(fan) symmetry in frequency 
domain.  All these filters are  available for HomoMorphic 
proceesing option as well</p>

<P>Filter radial length can be specified.  To avoid
wrap around error, internally the transforms are in an extended frame size.</P> 
<P> filter values specified must correspond to those seen in test display.Freq depending on type of filter correspond to center of notch freq, highest freq of low cut or lowest freq of high cut or lower freq of  band or lower angle of a fan filter, or xfreq of a point Similarly the second freq value corresponds to high freq end of  band, or higher angle of fan, or y freq of point. Even though disregarded by low cut, high cut or notch filters, a value must be specified at this position.  

<P>Homomorphic filtering :- The input image can be considered as the multiplication of incident light
and the reflectivity of objects. While incident light varies usually slowly, the reflectivity
varies more quickly. Homomorphic filtering is done to separate these components and specifying an
appropriate low cut (high pass) filter.Scaling may be needed.</P>

<P>Standard filters are specified by sets of 5 integers:
<BR> First Integer is symmetry 1, Circular, 2. Horizontal, 3, vertical, 4. Linear Fan, 5. Point
<BR> Second Integer is type 1. low cut, 2. High cut, 3. Band Pass, 4, Band stop, 5. Notch.
<BR>Third Integer is  Freq1( freq of lowcut or highcut) ( notch freq)(low freq of band) or X freq coordinate of point or angle1 for linear fan
<BR>Fourth Integer is freq2 .( high freq of band)(or angle2 for linear fan)or y freq coordinate of point
<BR> Fifth integer is Degree of sharpness. 0 to 24. If 0 Gaussian filter otherwise Butterworth filter is designed.
 <BR> Up to 12 such sets can be specified and they will be cascaded. 
<BR></P>
<P> In case of Fan filter, angle1 and angle2 are to be specified 
in place of freq1 and freq2. The Fan must wholly lie within 1 to 89 degrees  or 91 to 179 degrees. For band pass or reject angle1 must be less than angle2. The Fan filter is designed depending upon input angles ( for 1 to 89)in 1st and 3rd quadrant or ( for 91 to 179)in 2nd and 4th quandrants surrounding the origin. So a second Fan filter may need to be specified to cover all quadrants if so desired.
 <br> Please note that all filters have diagonal quadrant symmetry as the power spectrum behaves such. ( First and third quadrants are similar so also 2nd and 4th Quadrants).
<p>F2QTest function is a visual display of  the power spectrum, shown in 
 the left half and if a filter is specified  (optional),it is shown in right half of screen.
 It should be noted that the horizontal and vertical frequencies
 must be related to the rulers provided. Depending on the readability considerations 
 ruler may have any of the graduations for frequency values of  100, 50( or 20) and 10.
  </p>
 
<p>Presence of sharp high amplitude objects (such as logos) may overwhelm the 
image frequencies and can make finding low level noise frequencies difficult. (Using morph=true
 for test can bring out these clearly). As a sharp discontinuity requires all frequencies of 
spectrum to be present, any filtering that affects the balance can create
undesirable ringing. If possible cropping and re joining after processing may
be useful in those cases.</p>

<P>Rescale facility is available. But Avisynth has better scaling functions. 
Where low frequencies and the value at origin is affected,  rescaling may be needed</P>

<p>F2QTest and F2QUiver accepts Only  Planar Y U V or packed RGB formats. F2QTest uses  Y of YUV or G of RGB formats for analysis.   . F2Quiver on the other hand filters all 3 colors of RGB and if opted Y, U, V of YUV444 formats. For other YUV formats only Y is filtered. Parameters for both functions are identical </p>
 
<br> F2Quiver and F2QTest are thread safe. ( MT_NICE_FILTER). 
<BR>

<table border="2" bordercolorlight="#c0c0c0" bordercolordark="#000000">

<caption align="top"><b>Details of parameters</b> </caption>
<tr>
       <td><b>Description</b></td>
       <td><b>Name</b></td>
       <td><b>Type</b></td>
       <td><b>Limits</b></td>
       <td><b>Default</b></td>
</tr>
<tr>
       <td>Input clip</td>
       <td></td>
       <td>clip</td>
       <td></td>
       <td>none</td>
</tr>

<tr>
       <td>Array of values</td>
       <td></td>
       <td>sets of integers.  
	   For F2Quiver atleast one set must be specified. </td>
       <td></td>
       <td>none</td>
</tr>
<tr>
       <td>Is this homomorphic process? </td>
       <td>morph</td>
       <td>boolean</td>
       <td>true or false</td>
       <td>false</td>
</tr>

<tr>
       <td>Is rescaling of output required? Ignored by F2QTest </td>
       <td>rescale</td>
       <td>boolean</td>
       <td>true or false</td>
       <td>false</td>
</tr>

<tr>
       <td>gamma value to be used for spectral display scaling. Ignored by F2Quiver </td>
       <td>gamma</td>
       <td>float</td>
       <td>1.0 is no scaling</td>
       <td>0.05</td>
</tr>
<tr>
       <td>Filter radial length. Ignored by F2QTest </td>
       <td>frad</td>
       <td>integer</td>
       <td>16 to 128 in steps of 4 and less than 1/8 of frame dimension</td>
       <td>32</td>
</tr>
<tr>
       <td>Are u and v planes of YUV444 to be filtered? Ignored by F2QTest </td>
       <td>uv</td>
       <td>boolean</td>
       <td>true or false</td>
       <td>false</td>
</tr>



</table>


<BR>Usage examples:-
<BR>

<Pre>
# F2Quiver(5,5,60,-35,20,1,2,120,60,8,4,1,70,80,4,3,4,40,42,18,morph =false,gamma=0.04)
#F2QTest(5,5,60,-35,20,1,2,120,60,8,4,1,70,80,4,3,4,40,42,18,morph =false,gamma=0.04)
#F2QTest(4,5,105,160,14,frad=16)
#F2QTest(3,5,105,120,1,frad=20)
#F2QTest(2,2,105,100,4,frad=24)
F2QTest(1,3,5,60,24,frad=32)
#

</Pre>

<br>test panels
<BR>Input image<BR><img src="./FQInput0.png" width="700" height="400" border="0">

<br>spectrum, filter  and output 
<br><img src="./F2Qtest0.png" width="1400" height="400" border="0">
<br>
<br>
F2QTest(1,1,35,20,1,2,4,60,68,20,3,5,60,1,14,5,2,80,100,18,4,4,100,104,2)
<br>In this call first filter is circular lowcut,second is horizontal band reject, third is vertical notch, fourth is point symmetry and fifth is fan band reject filter. All are cascaded.The display is
<br><img src="./F2QTestFreq.png" width="320" height="480" border="0">
<table>

<tr>
       <td>To my<a href="../index.html"> index page</a></td>
	   <td>down load<a href="manyPlus.7z"> plugin</a></td>
       <td>To <a href="http://www.avisynth.nl">Avisynth</a> </td>
</tr>
</table>
</body>
</html>
